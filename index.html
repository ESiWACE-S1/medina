<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Medina by CyIClimate</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Medina</h1>
        <p>MECCA development in accelerators - KPP Fortran to CUDA source-to-source pre-processor</p>

        <p class="view"><a href="https://github.com/CyIClimate/medina">View the Project on GitHub <small>CyIClimate/medina</small></a></p>


        <ul>
          <li><a href="https://github.com/CyIClimate/medina/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/CyIClimate/medina/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/CyIClimate/medina">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="medina-kpp-fortran-to-cuda-source-to-source-pre-processor" class="anchor" href="#medina-kpp-fortran-to-cuda-source-to-source-pre-processor" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MEDINA: KPP Fortran to CUDA source-to-source pre-processor</h1>

<p><em>Disclaimer: This software is in alpha-test mode, 
equivalent to the MESSy red traffic light status.
No unexpected behaviour was observed under testing, and users are 
invited to test with their model setup. However, no express guarantee
is provided for production simulations.</em> </p>

<h2>
<a id="1-requirements" class="anchor" href="#1-requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. Requirements:</h2>

<h3>
<a id="software" class="anchor" href="#software" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Software:</h3>

<p>CUDA compiler and python are required for the processor;
<a href="http://www.messy-interface.org/">EMAC</a> (ECHAM/MESSy) Earth System Model.</p>

<h3>
<a id="hardware" class="anchor" href="#hardware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Hardware:</h3>

<p>CUDA compatible GPU. </p>

<h2>
<a id="2-installation" class="anchor" href="#2-installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. Installation:</h2>

<p>There are two files required to enable using the GPUs: 
<code>f2c_alpha.py</code>  and <code>kpp_integrate_cuda_prototype.cu</code>. </p>

<p>The files have to be available in the messy/util directory. 
No additional changes are required. </p>

<p>Note: MESSy has to be linked with the <code>-lcudart</code> flag. 
For example, you can append it to the <code>SPEC_NETCDF_LIB</code> variable 
in the configuration file (under <code>config/mh-XXXX</code>).</p>

<h2>
<a id="3-running-the-mecca-fortran-to-cuda-source-to-source-pre-processor" class="anchor" href="#3-running-the-mecca-fortran-to-cuda-source-to-source-pre-processor" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. Running the MECCA Fortran to CUDA source-to-source pre-processor:</h2>

<p>You have to enter the <code>./messy/util directory</code> to execute the
preprocessor, by running "<code>python f2c_alpha.py</code>". The preprocessor expects
the following files to be in place:</p>

<ul>
<li>    messy/smcl/messy_mecca_kpp.f90</li>
<li>    messy/smcl/messy_cmn_photol_mem.f90</li>
<li>    messy/smcl/messy_main_constants_mem.f90</li>
<li>    messy/util/kpp_integrate_cuda_prototype.cu</li>
<li>    messy/smcl/specific.mk</li>
<li>    messy/smcl/Makefile.m</li>
</ul>

<p>If any of these files is missing or not configured as in the MESSy release,
the preprocessor will stop with an error message.</p>

<h2>
<a id="4-running-emac-with-gpu-mecca-and-improving-performance" class="anchor" href="#4-running-emac-with-gpu-mecca-and-improving-performance" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>4. Running EMAC with GPU MECCA and improving performance:</h2>

<p>The runtime parameter <code>NPROMA</code> should be set to a value not greater than 128.
This allows for optimal memory allocation and performance on the GPU.</p>

<p>Warning: When running multiple CPU processes per GPU, if
memory is not enough the CUDA runtime will fail silently - without any
error. A solution in that case is to use the Multi-process service (MPS) provided
by NVIDIA as an alternative.</p>

<p>No issues reported with the latest generation of NVIDIA Pascal architectures.</p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>For assistance or to report problems please contact the maintainers:
T. Christoudias (<a href="https://github.com/theoc" class="user-mention">@theoc</a>); M. Alvanos (<a href="https://github.com/malvanos" class="user-mention">@malvanos</a>)</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/CyIClimate">CyIClimate</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
